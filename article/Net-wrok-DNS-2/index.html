<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content>
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css">
    <script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script>

    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          DNS服务(2) - 西木 | Blog
        
    </title>

    <link rel="canonical" href="http://yoursite.com/article/Net-wrok-DNS-2/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/css/beantech.min.css">

    <link rel="stylesheet" href="/css/donate.css">

    <link rel="stylesheet" href="/css/search.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script>hljs.initHighlightingOnLoad();</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('/img/header_img/archive.jpg')
            /*post*/
        
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#网络" title="网络">网络</a>
                            
                        </div>
                        <h1>DNS服务(2)</h1>
                        <h2 class="subheading">DNS服务的搭建（Bind）</h2>
                        <span class="meta">
                            Posted by Jason Lee on
                            2021-01-11
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">木西笔记</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1><span id="dns-服务简介">DNS 服务简介</span></h1>
<ul>
<li>接上篇 <a href="https://icefrozen.github.io/article/Net-wrok-DNS-1/" target="_blank" rel="noopener">DNS服务(1)</a> 简述了DNS的诞生和结构，本节来实际操作一遍，搭建一个DNS服务器。</li>
</ul>
<h1><span id="dns-服务单台服务器">DNS 服务单台服务器</span></h1>
<h2><span id="dns-服务器准备">DNS 服务器准备</span></h2>
<ul>
<li>CentOS7 ip 为 192.168.100.10</li>
<li>user 用户为root 用户。</li>
</ul>
<h2><span id="安装bind">安装Bind</span></h2>
<ul>
<li>查看本机内bind 软件情况</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 ~]<span class="comment"># rpm -qa | grep ^bind</span></span><br><span class="line"><span class="built_in">bind</span>-libs-9.11.4-26.P2.el7_9.3.x86_64</span><br><span class="line"><span class="built_in">bind</span>-export-libs-9.11.4-16.P2.el7_8.6.x86_64</span><br><span class="line"><span class="built_in">bind</span>-license-9.11.4-26.P2.el7_9.3.noarch</span><br><span class="line"><span class="built_in">bind</span>-libs-lite-9.11.4-26.P2.el7_9.3.x86_64</span><br><span class="line"><span class="built_in">bind</span>-utils-9.11.4-26.P2.el7_9.3.x86_64</span><br><span class="line"><span class="built_in">bind</span>-9.11.4-26.P2.el7_9.3.x86_64</span><br><span class="line">[root@CentOS7 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>报名</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>bind</td>
<td>BIND主程序</td>
</tr>
<tr>
<td>bind-utils</td>
<td>客户端搜索主机名的相关命令</td>
</tr>
<tr>
<td>bind-libs</td>
<td>BIND相关的库文件</td>
</tr>
<tr>
<td>bind-chroot</td>
<td>将BIND设定文件和程序限制在虚拟根目录下</td>
</tr>
</tbody>
</table>
<ul>
<li>安装bind</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install bind-utils bind bind-devel bind-libs</span><br></pre></td></tr></table></figure>
<h2><span id="配置文件">配置文件</span></h2>
<table>
<thead>
<tr>
<th>文件目录</th>
<th>说明</th>
<th>详解</th>
</tr>
</thead>
<tbody>
<tr>
<td>/etc/hosts</td>
<td>主机的一个文件列表</td>
<td>添加记录如:111.13.100.92</td>
</tr>
<tr>
<td>/etc/resolv.conf</td>
<td>转换程序配置文件</td>
<td>一般存放的是域名服务器的ip地址 记录如 nameserver <a href="http://xxx.xxx.xxx.xxx" target="_blank" rel="noopener">xxx.xxx.xxx.xxx</a> 一般不要指定超过3个服务器</td>
</tr>
<tr>
<td>/etc/named.conf</td>
<td>BIND主文件</td>
<td>设置一般的name参数，指向该服务器使用的域数据库的信息源</td>
</tr>
<tr>
<td>/var/named/named.ca</td>
<td>根域名配置服务器指向文件</td>
<td>指向根域名配置服务器，用于告诉缓存服务器初始化</td>
</tr>
<tr>
<td>/var/named/localhost.zone</td>
<td>localhost区正向域名解析文件</td>
<td>用于将本地IP地址（127.0.0.1）转换为本地回送IP地址（127.0.0.1）</td>
</tr>
<tr>
<td>/var/named/name.local</td>
<td>localhost区反向域名解析文件</td>
<td>用于将localhost名字转换为本地回送IP地址（127.0.0.1）</td>
</tr>
</tbody>
</table>
<h2><span id="配置主配置文件etcnameconf">配置主配置文件/etc/name.conf</span></h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">options &#123;</span><br><span class="line">    listen-on port 53 &#123; any; &#125;; <span class="comment"># 绑定在所有ipv4的网卡上</span></span><br><span class="line">    listen-on-v6 port 53 &#123; ::1; &#125;;  <span class="comment"># 绑定在所有ipv6的网卡上</span></span><br><span class="line">    directory     <span class="string">"/var/named"</span>;  <span class="comment"># bind 主目录</span></span><br><span class="line">    dump-file     <span class="string">"/var/named/data/cache_dump.db"</span>;</span><br><span class="line">    statistics-file <span class="string">"/var/named/data/named_stats.txt"</span>; <span class="comment"># statistics-file 统计文件</span></span><br><span class="line">    memstatistics-file <span class="string">"/var/named/data/named_mem_stats.txt"</span>;</span><br><span class="line">    recursing-file  <span class="string">"/var/named/data/named.recursing"</span>;</span><br><span class="line">    secroots-file   <span class="string">"/var/named/data/named.secroots"</span>;</span><br><span class="line">    allow-query     &#123; any; &#125;;           <span class="comment"># 允许所有机器查询</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">#   是否允许迭代查询 </span></span><br><span class="line">    recursion yes;</span><br><span class="line">    dnssec-enable yes;</span><br><span class="line">    dnssec-validation yes;</span><br><span class="line">    bindkeys-file <span class="string">"/etc/named.iscdlv.key"</span>;</span><br><span class="line">    managed-keys-directory <span class="string">"/var/named/dynamic"</span>;</span><br><span class="line">    pid-file <span class="string">"/run/named/named.pid"</span>;</span><br><span class="line">    session-keyfile <span class="string">"/run/named/session.key"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">logging &#123;</span><br><span class="line">        channel default_debug &#123;</span><br><span class="line">                file <span class="string">"data/named.run"</span>;</span><br><span class="line">                severity dynamic;</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">"."</span> IN &#123;</span><br><span class="line">    <span class="built_in">type</span> hint;</span><br><span class="line">    file <span class="string">"named.ca"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">include <span class="string">"/etc/named.rfc1912.zones"</span>;</span><br><span class="line">include <span class="string">"/etc/named.root.key"</span>;</span><br></pre></td></tr></table></figure>
<p>这面我们来挑选几个详细解释一下配置文件。</p>
<ul>
<li>
<p>recursion 是否允许迭代查询 如果你配置的是一个权威服务器，则不能进行迭代查询，如果你配置的是个缓存DNS服务，那么你需要将迭代查询开启。</p>
</li>
<li>
<p>dnssec 相关配置<br>
DNSSEC通过为通过为DNS中的数据添加数字签名信息，使得客户端在得到应答消息后可以通过检查此签名信，使得客户端在得到应答消息后可以通过检查此签名信息来判断应答数据是否权威和真实，从而为 从而为DNS数据提供数据来源验证和数据完整性检验，可以防止针对 可以防止针对DNS的相关攻击，这里不做相关的介绍</p>
</li>
<li>
<p>include 这里是我们的配置区域文件 named.root.key 根DNS解析服务器</p>
</li>
</ul>
<h2><span id="增加-配置区域文件">增加 配置区域文件</span></h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/named.rfc1912.zones</span><br><span class="line"></span><br><span class="line">zone <span class="string">"icefornze.com"</span> IN &#123;            <span class="comment"># 测试域名为 icefornze.com</span></span><br><span class="line">        <span class="built_in">type</span> master;                <span class="comment"># DNS 服务器类型 master</span></span><br><span class="line">        file <span class="string">"icefornze.com.zone"</span>;  <span class="comment"># 区域文件解析 该文件目录为 /var/named/</span></span><br><span class="line">        allow-update &#123;none;&#125;;       </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在 /var/named/ 新建 icefornze.com.zone 文件增加记录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$TTL</span> 1D                                                             ;TTL 修改配置生效时间，默认为一天</span><br><span class="line">@       IN      SOA     ns.icefornze.com.  root.icefornze.com. (</span><br><span class="line">                                                                20201221     ; serial，配置编号，每次改完配置 +1，这样从服务器就知道更新配置</span><br><span class="line">                                                                1D           ; refresh，从服务器刷新时间，默认一天刷新一次</span><br><span class="line">                                                                1h           ; retry，如果刷新失败，默认1小时重试一次</span><br><span class="line">                                                                1W           ; expire，缓存过期时间，一周</span><br><span class="line">                                                                3H          ; minimum</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加记录文件 NS 记录 以及A 记录 和www 记录</span></span><br><span class="line">        IN NS      ns.icefornze.com.</span><br><span class="line">ns      IN A    192.168.100.10</span><br><span class="line">        IN A    192.168.100.10</span><br><span class="line">www     IN A    192.168.100.10</span><br></pre></td></tr></table></figure>
<h2><span id="设置nameserver服务器">设置nameserver服务器</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;nameserver 192.168.100.10&quot; &gt;&gt; /etc/resolv.conf</span><br></pre></td></tr></table></figure>
<h2><span id="检查配置文件">检查配置文件</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 检查主配置</span><br><span class="line">named-checkconf /etc/named.conf</span><br><span class="line"></span><br><span class="line"># 检查 zone 配置</span><br><span class="line">named-checkzone icefornze.com /var/named/icefornze.com.zone</span><br></pre></td></tr></table></figure>
<h2><span id="启动服务">启动服务</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">systemctl start named</span><br><span class="line">systemctl enable named</span><br><span class="line"></span><br><span class="line">查看是否启动</span><br><span class="line"></span><br><span class="line">[root@CentOS7 ~]# netstat -tlunp | grep 53</span><br><span class="line">tcp        0      0 192.168.100.10:53       0.0.0.0:*               LISTEN      1927/named</span><br><span class="line">tcp        0      0 127.0.0.1:53            0.0.0.0:*               LISTEN      1927/named</span><br><span class="line">tcp        0      0 127.0.0.1:953           0.0.0.0:*               LISTEN      1927/named</span><br><span class="line">tcp6       0      0 ::1:953                 :::*                    LISTEN      1927/named</span><br><span class="line">udp        0      0 192.168.100.10:53       0.0.0.0:*                           1927/named</span><br><span class="line">udp        0      0 127.0.0.1:53            0.0.0.0:*                           1927/named</span><br></pre></td></tr></table></figure>
<h2><span id="实验成功与否">实验成功与否</span></h2>
<p>我们使用nslookup 验证一下，发现验证不过。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 named]<span class="comment"># nslookup</span></span><br><span class="line">&gt; icefornze.com</span><br><span class="line">;; Got SERVFAIL reply from 192.168.100.10, trying next server</span><br><span class="line">;; Got SERVFAIL reply from 192.168.100.10, trying next server</span><br><span class="line">Server:		119.29.29.29</span><br><span class="line">Address:	119.29.29.29<span class="comment">#53</span></span><br><span class="line"></span><br><span class="line">** server can<span class="string">'t find icefornze.com: NXDOMAIN</span></span><br></pre></td></tr></table></figure>
<p>这是时候，我们要检查一下named解析文件的权限，我们发现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 named]<span class="comment"># ls -alt</span></span><br><span class="line">总用量 20</span><br><span class="line">drwxrwx--T.  5 root  named  153 1月  31 20:25 .</span><br><span class="line"><span class="comment">## 这里是问题， 我们的权限组设置是root。这个时候，我们需要将权限组整理成 named</span></span><br><span class="line">-rw-r-----.  1 root  root   224 1月  31 20:25 icefornze.com.zone  </span><br><span class="line">-rw-r-----.  1 root  named  152 12月 15 2009 named.empty</span><br><span class="line">-rw-r-----.  1 root  named  168 12月 15 2009 named.loopback</span><br><span class="line">-rw-r-----.  1 root  named  152 6月  21 2007 named.localhost</span><br><span class="line"></span><br><span class="line">[root@CentOS7 named]<span class="comment"># chown -R root:named icefornze.com.zone</span></span><br><span class="line">[root@CentOS7 named]<span class="comment"># ls -alt</span></span><br><span class="line">drwxrwx--T.  5 root  named  153 1月  31 20:25 .</span><br><span class="line">-rw-r-----.  1 root  named  224 1月  31 20:25 icefornze.com.zone</span><br><span class="line">drwxrwx---.  2 named named   60 1月  31 20:24 dynamic</span><br><span class="line">drwxrwx---.  2 named named  127 1月  24 16:00 data</span><br><span class="line">drwxr-xr-x. 20 root  root   280 12月 20 20:58 ..</span><br><span class="line">drwxrwx---.  2 named named    6 12月 16 00:32 slaves</span><br><span class="line">-rw-r-----.  1 root  named 2253 4月   5 2018 named.ca</span><br><span class="line">-rw-r-----.  1 root  named  152 12月 15 2009 named.empty</span><br><span class="line">-rw-r-----.  1 root  named  168 12月 15 2009 named.loopback</span><br><span class="line">-rw-r-----.  1 root  named  152 6月  21 2007 named.localhost</span><br></pre></td></tr></table></figure>
<h2><span id="验证一下">验证一下</span></h2>
<p>Ping 一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 named]# ping www.icefornze.com</span><br><span class="line">PING www.icefornze.com (192.168.100.10) 56(84) bytes of data.</span><br><span class="line">64 bytes from CentOS7 (192.168.100.10): icmp_seq=1 ttl=64 time=0.010 ms</span><br></pre></td></tr></table></figure>
<h1><span id="dns-主从服务器的搭建">DNS 主从服务器的搭建</span></h1>
<ol>
<li>主从 DNS 的搭建开始的时候其实是和单机搭建一样的，我们修改主服务器的配置文件：/etc/named.rfc1912.zones<br>
将我们之前的配置进行修改：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">zone <span class="string">"icefornze.com"</span> IN &#123;           <span class="comment"># 测试用的域是 icefornze.com</span></span><br><span class="line">        <span class="built_in">type</span> master;</span><br><span class="line">        file <span class="string">"icefornze.com.zone"</span>;  <span class="comment"># 配置文件为 icefornze.com.zone，该文件目录为 /var/named/ 下</span></span><br><span class="line">        allow-update &#123; 192.168.100.113; &#125;;</span><br><span class="line">        allow-transfer &#123; 192.168.100.113; &#125;;    <span class="comment"># 允许同步DNS的辅助服务器IP</span></span><br><span class="line">        also-notify &#123; 192.168.100.113; &#125;;</span><br><span class="line">        notify yes;                             <span class="comment"># 启用变更通告，当主文件变更，通知从进行比较同步</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>从服务器也安装 bind 并将 /etc/named.conf 配置拷贝过来。接着也是配置：/etc/named.rfc1912.zones，此时就能体现主从的不同：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">zone <span class="string">"icefornze.com"</span> IN &#123;</span><br><span class="line">        <span class="built_in">type</span> slave;</span><br><span class="line">        file <span class="string">"slaves/icefornze.com.zone"</span>;</span><br><span class="line">        masters &#123; 192.168.100.10; &#125;;   <span class="comment"># 指定主服务器的 IP</span></span><br><span class="line">        masterfile-format text;         <span class="comment"># 指定区域文件的格式为text，不指定有可能会为乱码</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>我们不需要再去配置 icefornze.com.zone 文件，因为我们需要去主同步。所有直接启动从的 dns 服务。重启成功后我们会发现，在从服务器的 /var/named/slaves 目录下，icefornze.com.zone 已经同步成功。我们修改主服务器的 icefornze.com.zone，新加解析的同时，修改配置编号，让从能够探测到变化。<br>
此时我们重启主服务器，会发现从服务器就能够同步成功。顺便值得一提的是，我这里使用 reload named 服务并没有使配置生效。</p>
<h1><span id="子域授权">子域授权</span></h1>
<h3><span id="什么是子域授权">什么是子域授权</span></h3>
<p>举例(1)，假设我们是域名为com下所管理的域，如果需要让我们xxx.icefornze.com解析交给我们的ns.icefornze.com来解析，就需要授权，<a href="http://xn--ns-kw2ckd3vx67bgvftpbo4k9uolykph9b6v2cjpr.icefornze.com" target="_blank" rel="noopener">并且将这个子域的解析授予ns.icefornze.com</a> 这个服务器。</p>
<p><a href="http://xn--xxx-x98dx8lky5a9nha0876aqu8c.icefornze.com" target="_blank" rel="noopener">那么所有的有关xxx.icefornze.com</a> <a href="http://xn--ns-2f3cvgy1uryam91ekusi9u9edp07ddciia9z120ehusla.icefornze.com" target="_blank" rel="noopener">的询问请求都会被我们告知去询问ns.icefornze.com</a> 服务器，并将 <a href="http://ns2.icefornze.com" target="_blank" rel="noopener">ns2.icefornze.com</a> 的ip地址告诉请求客户端。</p>
<p><img src="/article/Net-wrok-DNS-2/Net-wrok-DNS-2-1612101783761.png" alt></p>
<h2><span id="定义转发服务器">定义转发服务器</span></h2>
<h3><span id="其他域名访问我们的域名流程">其他域名访问我们的域名流程</span></h3>
<p>当用户查询DNS服务器，当DNS数据库有相应的记录时则会回应用户，如果没有，则DNS会直接区询问根域,然后根域会一级一级的询问相应的子域,直到帮用户查询到相应记录.</p>
<p><img src="/article/Net-wrok-DNS-2/Net-wrok-DNS-2-1612102348591.png" alt></p>
<p>试想一下，如果我们的 ohter域名服务器 当请求 <a href="http://www.icefornzen.com" target="_blank" rel="noopener">www.icefornzen.com</a> 的时候知道直接去 <a href="http://icefornze.com" target="_blank" rel="noopener">icefornze.com</a> 服务器下去询问呢，是不是就省去了1， 2，3，4 的步骤呢？</p>
<p>这就是DNS转发功能的实现，也就是说DNS没有对应记录时我们也可以让他把询问请求转发到我们指定的服务器上去查询。DNS转发功能的实现主要是方便优先共享DNS数据库资源，节省查询时间，而不必每次一级一级的递归去询问根，这样节省带宽流量的时间。如下图：</p>
<p><img src="/article/Net-wrok-DNS-2/Net-wrok-DNS-2-1612102752449.png" alt></p>
<p>当转发功能开启之后，则必须满足：</p>
<ul>
<li>1）保证该非递归服务器不出现在客户机的 /etc/resolv.conf 的</li>
<li>2）证该非递归服务器不被其他 name server 当成转发器 （forwarder）</li>
</ul>
<h3><span id="定义转发服务器">定义转发服务器</span></h3>
<p>如上图所示，我们开启一个 <a href="http://staging.iceforzen.com" target="_blank" rel="noopener">staging.iceforzen.com</a> 的授权子域名，将www.staging.iceforzen.com的解析放到 192.168.100.12 这台机器上去。</p>
<ul>
<li>添加授权子域</li>
</ul>
<p>在192.168.100.10 编辑入下记录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vim /var/named/icefornze.com.zone</span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@       IN      SOA     icefornze.com.  root.icefornze.com. (</span><br><span class="line">                                                                20201221;</span><br><span class="line">                                                                1D      ;</span><br><span class="line">                                                                1h      ;</span><br><span class="line">                                                                1W      ;</span><br><span class="line">                                                                3H      ;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        IN  NS  ns</span><br><span class="line">ns      IN A    192.168.100.10</span><br><span class="line">www     IN A    192.168.100.10</span><br><span class="line">*       IN A    192.168.100.10</span><br><span class="line"><span class="comment"># 子域记录</span></span><br><span class="line">staging IN NS   ns.staging</span><br><span class="line">ns.staging      IN A    192.168.100.11</span><br></pre></td></tr></table></figure>
<p>重新reload 服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rndc reload</span><br></pre></td></tr></table></figure>
<ul>
<li>启动192.168.100.11 服务</li>
</ul>
<p>启动过程入上述,编辑</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">vim /etc/named.rfc1912.zones</span><br><span class="line"></span><br><span class="line">zone <span class="string">"staging.icefornze.com"</span> IN &#123;            <span class="comment"># 测试域名为 icefornze.com</span></span><br><span class="line">        <span class="built_in">type</span> master;                <span class="comment"># DNS 服务器类型 master</span></span><br><span class="line">        file <span class="string">"staging.icefornze.com.zone"</span>;  <span class="comment"># 区域文件解析 该文件目录为 /var/named/</span></span><br><span class="line">        allow-update &#123;none;&#125;;       </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>在 /var/named/ 新建 staging.icefornze.com.zone 文件增加记录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@       IN      SOA     staging.icefornze.com.  root.staging.icefornze.com. (</span><br><span class="line">                                                                20201221;</span><br><span class="line">                                                                1D      ;</span><br><span class="line">                                                                1h      ;</span><br><span class="line">                                                                1W      ;</span><br><span class="line">                                                                3H      ;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        IN NS   ns</span><br><span class="line">ns      IN A    192.168.100.11</span><br><span class="line">www     IN A    192.168.100.11</span><br><span class="line">*       IN A    192.168.100.11</span><br></pre></td></tr></table></figure>
<p>重启服务器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart named</span><br></pre></td></tr></table></figure>
<ul>
<li>实验效果<br>
在192.168.100.10 上dig <a href="http://www.staging.icefornze.com" target="_blank" rel="noopener">www.staging.icefornze.com</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 named]<span class="comment"># dig -t -A www.staging.icefornze.com @192.168.100.10</span></span><br><span class="line">;; Warning, ignoring invalid <span class="built_in">type</span> -A</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.11.4-P2-RedHat-9.11.4-26.P2.el7_9.3 &lt;&lt;&gt;&gt; -t -A www.staging.icefornze.com @192.168.100.10</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 35377</span><br><span class="line">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 1</span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 4096</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;www.staging.icefornze.com.	IN	A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">www.staging.icefornze.com. 86400 IN	A	192.168.100.11</span><br><span class="line"></span><br><span class="line">;; AUTHORITY SECTION:</span><br><span class="line">staging.icefornze.com.	86400	IN	NS	ns.staging.icefornze.com.</span><br><span class="line"></span><br><span class="line">;; Query time: 293 msec</span><br><span class="line">;; SERVER: 192.168.100.10<span class="comment">#53(192.168.100.10)</span></span><br><span class="line">;; WHEN: 日 1月 31 23:09:02 CST 2021</span><br><span class="line">;; MSG SIZE  rcvd: 87</span><br><span class="line"></span><br><span class="line">[root@CentOS7 named]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>在 192.168.100.11 上查询自己的解析</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 named]<span class="comment"># dig -t A www.staging.icefornze.com @192.168.100.11</span></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.11.4-P2-RedHat-9.11.4-26.P2.el7_9.3 &lt;&lt;&gt;&gt; -t A www.staging.icefornze.com @192.168.100.11</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 24828</span><br><span class="line">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 2</span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 4096</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;www.staging.icefornze.com.	IN	A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">www.staging.icefornze.com. 86400 IN	A	192.168.100.11</span><br><span class="line"></span><br><span class="line">;; AUTHORITY SECTION:</span><br><span class="line">staging.icefornze.com.	86400	IN	NS	ns.staging.icefornze.com.</span><br><span class="line"></span><br><span class="line">;; ADDITIONAL SECTION:</span><br><span class="line">ns.staging.icefornze.com. 86400	IN	A	192.168.100.11</span><br><span class="line"></span><br><span class="line">;; Query time: 0 msec</span><br><span class="line">;; SERVER: 192.168.100.11<span class="comment">#53(192.168.100.11)</span></span><br><span class="line">;; WHEN: 日 1月 31 23:09:59 CST 2021</span><br><span class="line">;; MSG SIZE  rcvd: 103</span><br></pre></td></tr></table></figure>
<ul>
<li>子域上查询父域的域名<br>
如果我们在192.168.100.11 上去查询 <a href="http://www.icefornze.com" target="_blank" rel="noopener">www.icefornze.com</a> 域名，则192.168.100.11 则会走递归查询到根服务器，由于我们的服务器没有得到com的授权，因此没有办法查询到。我们来实验一下</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 named]<span class="comment"># dig -t A www.icefornze.com @192.168.100.11</span></span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.11.4-P2-RedHat-9.11.4-26.P2.el7_9.3 &lt;&lt;&gt;&gt; -t A www.icefornze.com @192.168.100.11</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NXDOMAIN, id: 37028</span><br><span class="line">;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1</span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 4096</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;www.icefornze.com.		IN	A</span><br><span class="line"></span><br><span class="line">;; AUTHORITY SECTION:</span><br><span class="line">com.			247	IN	SOA	a.gtld-servers.net. nstld.verisign-grs.com. 1612105249 1800 900 604800 86400</span><br><span class="line"></span><br><span class="line">;; Query time: 0 msec</span><br><span class="line">;; SERVER: 192.168.100.11<span class="comment">#53(192.168.100.11)</span></span><br><span class="line">;; WHEN: 日 1月 31 23:12:13 CST 2021</span><br><span class="line">;; MSG SIZE  rcvd: 119</span><br><span class="line"></span><br><span class="line">[root@CentOS7 named]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>通过上述，我们看到要去查询com. 这个。 现在我们要通过配置让此命令可以查询到父域负责的解析的域名。</p>
<ul>
<li>全局配置</li>
</ul>
<p>编辑192.1638.100.11上的 /etc/named.conf 加上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">options &#123;</span><br><span class="line">   forward first; </span><br><span class="line">   forwarders &#123;192.168.100.10;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>①foward only  子DNS服务器指父DNS服务器请求DNS解析。</li>
<li>②foward first 子DNS服务器优先指向父DNS服务器，</li>
</ul>
<p>我们在来测试是否可以在11上dig <a href="http://xn--www-nb4j.icefornze.com" target="_blank" rel="noopener">通www.icefornze.com</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 named]<span class="comment"># rndc reload</span></span><br><span class="line">server reload successful</span><br><span class="line">[root@CentOS7 named]<span class="comment"># dig -t A www.icefornze.com @192.168.100.11</span></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.11.4-P2-RedHat-9.11.4-26.P2.el7_9.3 &lt;&lt;&gt;&gt; -t A www.icefornze.com @192.168.100.11</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 25350</span><br><span class="line">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 2</span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 4096</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;www.icefornze.com.		IN	A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">www.icefornze.com.	86400	IN	A	192.168.100.10</span><br><span class="line"></span><br><span class="line">;; AUTHORITY SECTION:</span><br><span class="line">icefornze.com.		86400	IN	NS	ns.icefornze.com.</span><br><span class="line"></span><br><span class="line">;; ADDITIONAL SECTION:</span><br><span class="line">ns.icefornze.com.	86400	IN	A	192.168.100.10</span><br><span class="line"></span><br><span class="line">;; Query time: 1 msec</span><br><span class="line">;; SERVER: 192.168.100.11<span class="comment">#53(192.168.100.11)</span></span><br><span class="line">;; WHEN: 日 1月 31 23:18:51 CST 2021</span><br><span class="line">;; MSG SIZE  rcvd: 95</span><br></pre></td></tr></table></figure>
<ul>
<li>定向配置</li>
</ul>
<p>当然我们还可以不用全局配置，可以特定的zone当中去配置,编辑 192.168.100.11 上的  /etc/named.rfc1912.zones</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">zone <span class="string">"icefornze.com."</span> &#123;</span><br><span class="line">        <span class="built_in">type</span> forward;</span><br><span class="line">        forwarders &#123; 192.168.100.10;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">systemcl restart named</span><br></pre></td></tr></table></figure>
<p>将我们的nameserver 指向自己</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolve.conf</span><br><span class="line"></span><br><span class="line">nameserver 192.168.100.11</span><br></pre></td></tr></table></figure>
<p>ping <a href="http://xn--www-p18d1b.icefornze.com" target="_blank" rel="noopener">一下www.icefornze.com</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 named]# ping www.icefornze.com</span><br><span class="line">PING www.icefornze.com (192.168.100.10) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.100.10 (192.168.100.10): icmp_seq=1 ttl=64 time=0.353 ms</span><br><span class="line">64 bytes from 192.168.100.10 (192.168.100.10): icmp_seq=2 ttl=64 time=0.681 ms</span><br></pre></td></tr></table></figure>
<p>可以成功</p>
<h1><span id="智能dns">智能DNS</span></h1>
<h2><span id="bind-关键配置">Bind 关键配置</span></h2>
<p>在names.conf 中有许多配置，这里列出个表格供大家参考</p>
<table>
<thead>
<tr>
<th>配置名称</th>
<th>功    能</th>
</tr>
</thead>
<tbody>
<tr>
<td>acl</td>
<td>定义一个访问控制列表，用于以后对列表中的IP进行访问控制</td>
</tr>
<tr>
<td>controls</td>
<td>定义有关本地域名服务器操作的控制通道，这些通道被rndc用来发送控制命令</td>
</tr>
<tr>
<td>include</td>
<td>把另一个文件中的内容包含进来做为主配置文件的内容</td>
</tr>
<tr>
<td>key</td>
<td>定义一个密匙信息，用于通过TSIG进行授权和认证的配置中</td>
</tr>
<tr>
<td>logging</td>
<td>设置日志服务器，以及日志信息的发送位置</td>
</tr>
<tr>
<td>options</td>
<td>设置DNS服务器的全局配置选项</td>
</tr>
<tr>
<td>server</td>
<td>定义了与远程服务器交互的规则</td>
</tr>
<tr>
<td>trusted-keys</td>
<td>定义信任的 DNSSED密匙</td>
</tr>
<tr>
<td>view</td>
<td>定义一个视图</td>
</tr>
<tr>
<td>zone</td>
<td>定义一个区域</td>
</tr>
</tbody>
</table>
<h2><span id="options">options</span></h2>
<p>options语句设定可以被整个BIND使用的全局选项。这个语句在每个配置文件中只有一处，如果出现多个options语句，则第一个options的配置有效，并且会产生一个警告信息。如果没有options语句，每个子语句使用默认值</p>
<h2><span id="acl">ACL</span></h2>
<p>acl主配置语句用于定义一个命名的访问列表，里面包含了一些用IP表示的主机，这个访问列表可以在其他语句使用，表示其所定义的主机。其格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">acl acl-name &#123;   </span><br><span class="line">    address_match_list   </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>address_match_list表示IP地址或IP地址集。其中，none、any、localhost和localnets这4个内定的关键字有特别含义，分别表示没有主机、任何主机、本地网络接口IP和本地子网IP。一个具体的例子如下所示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">acl &quot;someips&quot; &#123;                 //定义一个名为someips的ACL  </span><br><span class="line">  10.0.0.1; 192.168.23.1; 192.168.23.15;      //包含3个单个IP  </span><br><span class="line"> &#125;;  </span><br><span class="line"></span><br><span class="line">acl &quot;complex&quot; &#123;             //定义一个名为complex的ACL  </span><br><span class="line">  &quot;someips&quot;;                //可以包含其他ACL  </span><br><span class="line">  10.0.15.0/24;                 //包含10.0.15.0子网中的所有IP  </span><br><span class="line">  !10.0.16.1/24;                //非10.0.16.1子网的IP  </span><br><span class="line">  &#123;10.0.17.1;10.0.18.2;&#125;;   //包含了一个IP组  </span><br><span class="line">  localhost；                //本地网络接口IP（含实际接口IP和127.0.0.1）  </span><br><span class="line"> &#125;;  </span><br><span class="line"></span><br><span class="line">zone &quot;example.com&quot; &#123;  </span><br><span class="line">  type slave;  </span><br><span class="line">  file &quot;slave.example.com&quot;;  </span><br><span class="line">  allow-notify &#123;&quot;complex&quot;;&#125;;    //在此处使用了前面定义的complex访问列表  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2><span id="zone">Zone</span></h2>
<p>下面是Zone 配合选项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">zone zone_name [class] [</span><br><span class="line">&#123;</span><br><span class="line">        type ( master | slave | hint | stub | forward ) ;</span><br><span class="line">        [ allow-notify &#123; address_match_list &#125; ; ]</span><br><span class="line">        [ allow-query &#123; address_match_list &#125; ; ]</span><br><span class="line">        [ allow-transfer &#123; address_match_list &#125; ; ]</span><br><span class="line">        [ allow-update &#123; address_match_list &#125; ; ]</span><br><span class="line">        [ update-policy &#123; update_policy_rule [...] &#125; ; ]</span><br><span class="line">        [ allow-update-forwarding &#123; address_match_list &#125; ; ]</span><br><span class="line">        [ alsonotify</span><br><span class="line">        &#123; ip_addr [port ip_port] ; [ ip_addr [port ip_port] ; ... ] &#125;; ]</span><br><span class="line">        [ check-names (warn|fail|ignore) ; ]</span><br><span class="line">        [ dialup dialup_option ; ]</span><br><span class="line">        [ file string ; ]</span><br><span class="line">        [ forward (only|first) ; ]</span><br><span class="line">        [ forwarders</span><br><span class="line">        &#123; ip_addr [port ip_port] ; [ ip_addr [port ip_port] ; ... ] &#125;; ]</span><br><span class="line">        [ ixfr-base string ; ]</span><br><span class="line">        [ ixfr-tmp-file string ; ]</span><br><span class="line">        [ maintain-ixfr-base yes_or_no ; ]</span><br><span class="line">        [ masters [port ip_port] &#123; ip_addr [port ip_port] [key key]; [...] &#125; ; ]</span><br><span class="line">        [ max-ixfr-log-size number ; ]</span><br><span class="line">        [ max-transfer-idle-in number ; ]</span><br><span class="line">        [ max-transfer-idle-out number ; ]</span><br><span class="line">        [ max-transfer-time-in number ; ]</span><br><span class="line">        [ max-transfer-time-out number ; ]</span><br><span class="line">        [ notify yes_or_no | explicit ; ]</span><br><span class="line">        [ pubkey number number number string ; ]</span><br><span class="line">        [ transfer-source (ip4_addr | *) [port ip_port] ; ]</span><br><span class="line">        [ transfer-source-v6 (ip6_addr | *) [port ip_port] ; ]</span><br><span class="line">        [ notify-source (ip4_addr | *) [port ip_port] ; ]</span><br><span class="line">        [ notify-source-v6 (ip6_addr | *) [port ip_port] ; ]</span><br><span class="line">        [ zone-statistics yes_or_no ; ]</span><br><span class="line">        [ sig-validity-interval number ; ]</span><br><span class="line">        [ database string ; ]</span><br><span class="line">        [ min-refresh-time number ; ]</span><br><span class="line">        [ max-refresh-time number ; ]</span><br><span class="line">        [ min-retry-time number ; ]</span><br><span class="line">        [ max-retry-time number ; ]</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>zone语句定义了DNS服务器所管理的区，也就是哪一些域的域名是授权给该DNS服务器回答的。一共有5种类型的区，由其type子语句指定，具体名称和功能如下所示。</p>
<ul>
<li>Master（主域）：主域用来保存某个区域（<a href="http://xn--www-eo8e.wzvtc.cn" target="_blank" rel="noopener">如www.wzvtc.cn</a>）的数据信息。</li>
<li>Slave（辅域）：也叫次级域，数据来自主域，起备份作用。</li>
<li>Stub：Stub区与辅域相似，但它只复制主域的NS记录，而不是整个区数据。它不是标准DNS的功能，只是BIND提供的功能。</li>
<li>Forward（转发）：转发域中一般配置了 forward和forwarders子句，用于把对该域的查询请求转由其他DNS服务器处理。</li>
<li>Hint：Hint域定义了一套最新的根DNS服务器地址，如果没有定义，DNS服务器会使用内建的根DNS服务器地址。<br>
配置实例：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">zone &quot;.&quot; IN &#123;           //定义一个名为&quot;.&quot;的区，查询类为IN  </span><br><span class="line">	type hint;              //类型为hint  </span><br><span class="line">	file &quot;named.root&quot;;      //区文件是named.root  </span><br><span class="line">&#125;;  </span><br><span class="line"></span><br><span class="line">zone  &quot;1.10.10.in-addr.arpa&quot; IN &#123;     //定义一个名为1.10.10.in-addr.arpa的区，查询类为IN  </span><br><span class="line">        type master;                    //类型为master  </span><br><span class="line">        file &quot;named.1.10.10&quot;;       //区文件是named.1.10.10  </span><br><span class="line">        allow-update  &#123; none; &#125;;    //不允许任何客户端对数据进行更新  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2><span id="bind-view">Bind View</span></h2>
<p>我们需要知道什么是DNS VIEW??</p>
<p>DNS view简单的理解就是实现不同网段发出不同的请求却得出不同的DNS解析结果，有效的分流网络流量，减少服务器的压力，提高访问控制能力。在我国大家都知道，电信和网通之间访问速度是很慢的，但是像百度、sina这种大网站，不管我们怎么访问速度都是很快的，那么他们是采用什么样的技术呢？？</p>
<p>采用CDN（内容分发网络）技术实现的。在这次我们只讨论CND底层采用的DNS view技术。</p>
<p>view语句定义了视图功能。视图是BIND 9提供的强大的新功能，允许DNS服务器根据客户端的不同有区别地回答DNS查询，每个视图定义了一个被特定客户端子集见到的DNS名称空间。这个功能在一台主机上运行多个形式上独立的DNS服务器时特别有用。</p>
<p>视图（view）语句的定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">view view_name [class] &#123;</span><br><span class="line">        match-clients &#123; address_match_list &#125; ;</span><br><span class="line">        match-destinations &#123; address_match_list &#125; ;</span><br><span class="line">        match-recursive-only &#123; yes_or_no &#125; ;</span><br><span class="line">        [ view_option; ...]</span><br><span class="line">        zone-statistics yes_or_no ; ]</span><br><span class="line">        [ zone_statement; ...]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>视图是BIND9强大的新功能，允许名称服务器根据询问者的不同有区别的回答DNS查询。特别是当运行拆分DNS设置而不需要运行多个服务器时特别有用。每个视图定义了一个将会在用户的子集中见到的DNS名称空间。</p>
<p>配置实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">view &quot;internal&quot; &#123;</span><br><span class="line">	match-clients &#123; 10.0.0.0/8; &#125;;</span><br><span class="line">	// 应该与内部网络匹配.</span><br><span class="line">	// 只对内部用户提供递归服务.</span><br><span class="line">	// 提供example.com zone 的完全视图</span><br><span class="line">	//包括内部主机地址.</span><br><span class="line">	recursion yes;</span><br><span class="line">	zone &quot;example.com&quot; &#123;</span><br><span class="line">		type master;</span><br><span class="line">		file &quot;example-internal.db&quot;;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br><span class="line">view &quot;external&quot; &#123;</span><br><span class="line">	match-clients &#123; any; &#125;;</span><br><span class="line">	// 拒绝对外部用户提供递归服务</span><br><span class="line">	// 提供一个example.com zone 的受限视图</span><br><span class="line">	// 只包括公共可接入主机</span><br><span class="line">	recursion no;</span><br><span class="line">	zone &quot;example.com&quot; &#123;</span><br><span class="line">		type master;</span><br><span class="line">		file &quot;example-external.db&quot;;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2><span id="智能dns">智能DNS</span></h2>
<p>对于ACL、VIEW、ZONE的应用，DNS服务器有一个高级的功能，能够实现不同的用户访问同一个域名，把域名解析成不同的IP地址，使用户能够访问离他最近的服务器上的数据，这就是DNS服务器的视图功能。</p>
<p>使用DNS服务器的视图功能可以增加网站的响应速度。例如，当我们网站的数据同步在两台web服务器上时，一台是电信服务器，一台是网通服务器，那么我们肯定希望全国访问我们网站的用户在打开网站的时候，能够自动实现，电信用户访问电信服务器，网通用户访问网通服务器。</p>
<p>配置这种情况的前提是，web服务器必须要有一个电信的IP地址和一个网通的IP地址。DNS服务器的这种解析功能通常也被称之为智能解析。</p>
<p>DNS服务器的视图通常在配置文件中是使用view实现的。把要使用某些IP地址作单独访问的zone区域，统一放在一个命名的view段落中，并且在view中定义请求的IP地址或IP地址段，把IP地址写入match-clients选项中。如果像上面说的，区分电信和网通路线的话，那么可以使用两个acl访问控制列表写上电信或网通IP地址，定义电信网通路线，把acl名字写入view段落match-clients选项中。如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">acl telecomip&#123; tele_IP; ... &#125;;</span><br><span class="line">acl netcomip&#123; net_IP; ... &#125;;</span><br><span class="line">view telecom &#123;</span><br><span class="line">    match-clients &#123; telecomip; &#125;;</span><br><span class="line">    zone &quot;ZONE_NAME&quot; IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file &quot;ZONE_NAME.telecom&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">view netcom &#123;</span><br><span class="line">    match-clients &#123; netcomip; &#125;;</span><br><span class="line">    zone &quot;ZONE_NAME&quot; IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file &quot;ZONE_NAME.netcom&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">view default &#123;</span><br><span class="line">    match-clients &#123; any; &#125;;</span><br><span class="line">    zone &quot;ZONE_NAME&quot; IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file &quot;ZONE_NAME.netcom&quot;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>需要注意的是：</p>
<ul>
<li>(1)、如果使用了视图的功能，那么配置文件中的所有zone区域都要必须写在视图里面，如，配置文件里默认要配置的三个区域，根、127.0.0.1、1.0.0.127.in-addr.arpa都要写入视图。</li>
<li>(2)、在acl中定义IP地址，IP地址的写法可以是单个IP地址也可以是一个IP地址段加掩码，如：192.168.0.0/24。</li>
<li>(3)、视图是根据配置文件从上往下匹配的，所以希望优先访问的资源记录文件，区域应该尽量写前面。</li>
<li>(4)、如果定义的若干个视图的IP地址不全的话，那么可以在最后定义一个默认视图，match-clients选项中的IP地址写上any，代表如果此次访问的IP地址上面没有一个能匹配到，则在此处归类。</li>
</ul>
<h2><span id="参考">参考</span></h2>
<ul>
<li>
<p><a href="https://blog.itcloudblog.cn/Linux/BIND-View.html" target="_blank" rel="noopener">智能DNS（BIND+VIEW）的功能如何实现呢？？</a></p>
</li>
<li>
<p><a href="https://blog.csdn.net/zhu_tianwei/article/details/45104125" target="_blank" rel="noopener">DNS BIND之ACL、View、ZONE介绍</a></p>
</li>
</ul>

        
                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/article/lvs-3/" data-toggle="tooltip" data-placement="top" title="负载均衡（3）">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/article/lvs-2/" data-toggle="tooltip" data-placement="top" title="负载均衡（2）">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <br>

                <!--打赏-->
                
                    <div class="reward">
                        <div class="reward-button">赏 <span class="reward-code"> 
                            <span class="alipay-code"> <img class="alipay-img" src="alipay_url"><b>支付宝打赏</b></span> 
                            <span class="wechat-code"> <img class="wechat-img" src="wechatpay_url"><b>微信打赏</b> </span>
                            </span></div>
                        <p class="reward-notice">赞赏一下</p>
                    </div>
                
                <!--打赏-->

                <br>
                <!--分享-->
                
                    <div class="social-share"  data-wechat-qrcode-helper="" align="center"></div>
                    <!--  css & js -->
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!--分享-->
                <br>                       
                
                <!-- require APlayer -->
                

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->

                

            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

  
    <style>
      span.toc-nav-number{
        display: none
      }
    </style>
  
    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">DNS 服务简介</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">DNS 服务单台服务器</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">2.1.</span> <span class="toc-nav-text">DNS 服务器准备</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">2.2.</span> <span class="toc-nav-text">安装Bind</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">2.3.</span> <span class="toc-nav-text">配置文件</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">2.4.</span> <span class="toc-nav-text">配置主配置文件/etc/name.conf</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">2.5.</span> <span class="toc-nav-text">增加 配置区域文件</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">2.6.</span> <span class="toc-nav-text">设置nameserver服务器</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">2.7.</span> <span class="toc-nav-text">检查配置文件</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">2.8.</span> <span class="toc-nav-text">启动服务</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">2.9.</span> <span class="toc-nav-text">实验成功与否</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">2.10.</span> <span class="toc-nav-text">验证一下</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">DNS 主从服务器的搭建</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">子域授权</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">4.0.1.</span> <span class="toc-nav-text">什么是子域授权</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">4.1.</span> <span class="toc-nav-text">定义转发服务器</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">4.1.1.</span> <span class="toc-nav-text">其他域名访问我们的域名流程</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">4.1.2.</span> <span class="toc-nav-text">定义转发服务器</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">5.</span> <span class="toc-nav-text">智能DNS</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">5.1.</span> <span class="toc-nav-text">Bind 关键配置</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">5.2.</span> <span class="toc-nav-text">options</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">5.3.</span> <span class="toc-nav-text">ACL</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">5.4.</span> <span class="toc-nav-text">Zone</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">5.5.</span> <span class="toc-nav-text">Bind View</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">5.6.</span> <span class="toc-nav-text">智能DNS</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">5.7.</span> <span class="toc-nav-text">参考</span></a></li></ol></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#网络" title="网络">网络</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                </ul>
                
            </div>
        </div>
    </div>
</article>








<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>

<!-- chrome Firefox 中文锚点定位失效-->
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
<!-- smooth scroll behavior polyfill  -->
<script type="text/javascript" src="/js/smoothscroll.js"></script>
<script>
        $('#toc').on('click','a.toc-nav-text',function(a){
            document.getElementById(a.target.innerText.replace(/\s/g,'').replace(/\./g,'-').toLowerCase()).scrollIntoView(true);
            document.getElementById($(a.currentTarget).attr("href").replace("#","")).scrollIntoView({behavior: 'smooth' });
        })  
</script>


    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                
                    <li>
                        <a target="_blank" href="http://weibo.com/u/2028033763">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/IceFrozen">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Jason Lee 2022 
                    <br>
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="#">JasonLess</a> | 
                    <!-- <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="#" >
                    </iframe> -->
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>

<!-- Custom Theme search -->
<script src="/js/search.js"></script>
<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://yoursite.com/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>



<!-- search code -->

    <script type="text/javascript">      
      var search_path = "search.xml";
      if (search_path.length == 0) {
          search_path = "search.xml";
      }
      var path = "/" + search_path;
      searchFunc(path, 'local-search-input', 'local-search-result');
    </script>
 

<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = 'xxx';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="http://yoursite.com/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work --><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>

</html>
